<template>
    <div class="goods-page page-container">
        <div class="page-search clearfix">
            <el-input class="p-s-input" v-model.trim="searchOptions.name" placeholder="请输入货物名称" size="mini" clearable></el-input>
            <el-button type="primary" size="mini" class="p-s-btn" @click="getList">搜索</el-button>
            <div class="p-s-btn-right">
                <el-button type="success" size="mini" title="新建" @click="add">新建</el-button>
                <el-button type="primary" size="mini" title="导出" @click="exportExcel">导出</el-button>
                <el-button type="warning" size="mini" title="批量导入" @click="importExcel">批量导入</el-button>
            </div>
        </div>
        <div class="page-content">
            <div class="page-content-scroll-warp">
                <el-scrollbar class="scroll-wrap">
                    <el-table 
                        :data="tableData" 
                        style="width: 100%"
                        header-cell-class-name="custom-el-table-header-class"
                        cell-class-name="custom-el-table-cell-class-name"
                        @selection-change="handleSelectionChange"
                    >
                        <el-table-column align="center" type="selection" fixed="left"  v-model.trim="multipleSelection" width="55"></el-table-column>
                        <el-table-column
                            align="center"
                            type="index"
                            fixed="left"
                            :index="$indexMethod(0,searchOptions.currentPage,searchOptions.pageSize)"
                            label="序号"
                            width="80"
                        ></el-table-column>
                        <el-table-column
                            align="center"
                            prop="bigType"
                            show-overflow-tooltip
                            label="大类类型">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="name"
                            show-overflow-tooltip
                            width="180"
                            label="货物名称">
                            <template slot-scope="scope">
                                <el-popover placement="right" trigger="hover" width="800">
                                    <el-link type="primary" slot="reference" :underline="false">{{scope.row.name}}</el-link>
                                    <div class="goods-popover">
                                        <table class="organization-table" width="100%" borderColor="#eeeeee" cellspacing='0' cellpadding="5" border="1">
                                            <thead>
                                                <tr>
                                                    <th class="t-header-th" align="center" colspan="2">货物信息表</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th width="20%">大类类型</th>
                                                    <td>{{scope.row.bigType || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">货物名称</th>
                                                    <td>{{scope.row.name || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">厂商</th>
                                                    <td>{{scope.row.firm || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">品牌</th>
                                                    <td>{{scope.row.brand || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">型号</th>
                                                    <td>{{scope.row.type || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">款式</th>
                                                    <td>{{scope.row.design || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">成本价</th>
                                                    <td>{{scope.row.costPrice || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">销售价</th>
                                                    <td>{{scope.row.salesPrice || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">联系人</th>
                                                    <td>{{scope.row.contactPerson || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">联系电话</th>
                                                    <td>{{scope.row.phone || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">图片</th>
                                                    <td>
                                                        <viewimg-comp :options="{image: scope.row.goodsImg, smallImgShow: true}" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">产品资料</th>
                                                    <td>
                                                        <viewimg-comp :options="{image: scope.row.productImg, smallImgShow: true}" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">投标参数</th>
                                                    <td>{{scope.row.tenderParams || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">招标参数</th>
                                                    <td>{{scope.row.bidsParams || '-'}}</td>
                                                </tr>
                                                <tr>
                                                    <th width="20%">备注</th>
                                                    <td>{{scope.row.remark || '-'}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </el-popover>
                            </template>
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="firm"
                            show-overflow-tooltip
                            label="厂商">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="brand"
                            show-overflow-tooltip
                            label="品牌">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="type"
                            show-overflow-tooltip
                            label="型号">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="design"
                            show-overflow-tooltip
                            label="款式">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="costPrice"
                            show-overflow-tooltip
                            width="140"
                            label="成本价(元)">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="salesPrice"
                            show-overflow-tooltip
                            width="140"
                            label="销售价(元)">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="contactPerson"
                            show-overflow-tooltip
                            label="联系人">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="phone"
                            show-overflow-tooltip
                            label="联系电话">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="goodsImg"
                            width="120"
                            label="图片">
                            <template slot-scope="scope">
                                <viewimg-comp :options="{image: scope.row.goodsImg, smallImgShow: true, imgHeight: '40px'}" />
                            </template>
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="goodsImg"
                            width="120"
                            label="产品资料">
                            <template slot-scope="scope">
                                <viewimg-comp :options="{image: scope.row.productImg, smallImgShow: true, imgHeight: '40px'}" />
                            </template>
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="tenderParams"
                            show-overflow-tooltip
                            label="投标参数">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="bidsParams"
                            show-overflow-tooltip
                            label="招标参数">
                        </el-table-column>
                        <el-table-column
                            align="center"
                            prop="remark"
                            show-overflow-tooltip
                            label="备注">
                        </el-table-column>
                        <el-table-column align="center" label="操作" fixed="right">
                            <template slot-scope="scope">
                                <el-link  @click="edit(scope.row)" :underline="false" type="warning">编辑</el-link>
                            </template>
                        </el-table-column>
                    </el-table>
                    <!-- 分页器 -->
                    <div class="page-pagination">
                        <pagination-comp @currentChange="currentChange" :currentPage="searchOptions.currentPage" :total="searchOptions.total" />
                    </div>
                </el-scrollbar>
            </div>
        </div>
    </div>
</template>
<script>
    import goodsApi from "@/api/goods-api";
export default {
    name: 'goods-page',
    data() {
        return {
            multipleSelection: [],
            tableData: [],
            searchOptions: {
                currentPage: 1, //当前页码
                pageSize: 20, //每页显示条数
                total: 0,
                name: "",
            },
            tableData: []
        }
    },
    created(){
        this.getList();
    },
    methods: {
        /* 获取数据 */
        getList() {
            goodsApi.getList(this.searchOptions).then( res => {
                this.tableData = res.data.data.list;
                this.searchOptions.total=res.data.data.total;
            }).catch(function (res) {
                console.log(res);
            });
        },
        /* 新加货物 */
        add() {
            this.$router.push({ name: 'goods-page-add'})
        },
        /* 货物编辑 */
        edit(row) {
            this.$router.push({ name: 'goods-page-edit',query: {id:row.id,type:'edit'}})
        },
        /* 导出货物列表 */
        exportExcel() {

        },
        /* table 选择 */
        handleSelectionChange(rows){
            this.multipleSelection = rows;
        },
        currentChange(val) {
            this.searchOptions.currentPage = val;
            this.getList();
        },
        /* 批量导入 */
        importExcel() {
            this.$confirm('导入前请务必确认Excel表格数据无误, 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {

            }).catch(err => console.warn(err));
        }
    }
}
</script>
<style lang="scss" scoped>
    .goods-img {
        width: 80px;
        height: auto;
    }
</style>